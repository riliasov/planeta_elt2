# üì® Handover Response (ELT Core -> TG Team)
**–î–∞—Ç–∞:** 14.01.2026
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

## üõ† –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ 500 (–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏)
**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ `api/tasks` –∏ `api/booking`.

**–†–µ—à–µ–Ω–∏–µ:**
- **`webapp.tasks`**: –¢–∞–±–ª–∏—Ü–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞.
  - **–°–æ–∑–¥–∞–Ω–∞** –Ω–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `webapp.tasks` (—Å–∫—Ä–∏–ø—Ç `scripts/fix_handover_schema.sql`).
  - **–°—Ö–µ–º–∞:** `id` (UUID), `title`, `description`, `status` (default 'new'), `assignee_id`, timestamps.
  - **–î–æ—Å—Ç—É–ø:** –í—ã–¥–∞–Ω—ã –ø—Ä–∞–≤–∞ `GRANT ALL` –¥–ª—è —Ä–æ–ª–µ–π `authenticated` –∏ `service_role`. –í–∫–ª—é—á–µ–Ω RLS (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é policy —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—Å–µ –¥–ª—è authenticated).
  
- **`api/booking`**: –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
  - VIEW `public.api_schedule` –∏ `public.api_sales` —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ –¥–æ—Å—Ç—É–ø–Ω—ã.
  - –û—à–∏–±–æ–∫ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î –Ω–µ –≤—ã—è–≤–ª–µ–Ω–æ. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–æ–ª–µ–π, –Ω–æ –±–∞–∑–æ–≤—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –Ω–∞ –º–µ—Å—Ç–µ.

### 2. –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (Telegram)
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `lead_date` —É –ª–∏–¥–æ–≤.

**–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- –í—Å–µ–≥–æ –ª–∏–¥–æ–≤: **965**
- –õ–∏–¥–æ–≤ —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º `lead_date`: **965 (100%)**
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞.

### 3. RPC –§—É–Ω–∫—Ü–∏–∏
- –§—É–Ω–∫—Ü–∏–∏ `get_top_users` –∏ `get_telegram_leads_period` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ —Å—Ö–µ–º–µ `public`.

## üìÇ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã
- `scripts/fix_handover_schema.sql` ‚Äî SQL –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è `webapp.tasks`.
- `apply_fix.py` ‚Äî –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏.
- `check_handover.py` ‚Äî –°–∫—Ä–∏–ø—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü, –∫–æ–ª–æ–Ω–æ–∫ –∏ –¥–∞–Ω–Ω—ã—Ö).

### –£–¥–∞–ª–µ–Ω–Ω—ã–µ/–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –æ—Ç–ª–∞–¥–∫–∏ (`check_stg_tables.py`, `get_view_defs.py`) —É–¥–∞–ª–µ–Ω—ã.

---
**–ö –ø–µ—Ä–µ–¥–∞—á–µ:** –ú–æ–∂–Ω–æ –¥–µ–ø–ª–æ–∏—Ç—å WebApp v2.10.0. –≠–Ω–¥–ø–æ–∏–Ω—Ç –∑–∞–¥–∞—á –¥–æ–ª–∂–µ–Ω –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏.
